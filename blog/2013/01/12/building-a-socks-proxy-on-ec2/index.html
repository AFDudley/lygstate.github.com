
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Building a SOCKS proxy on EC2 - My Octopress Blog</title>
  <meta name="author" content="Yonggang Luo">

  
  <meta name="description" content="Permalink At the NXNE Mobile Hackathon, we ran into a small problem. The wifi set up in the room would only allow connections over HTTP and HTTPS, &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lygstate.github.com/blog/2013/01/12/building-a-socks-proxy-on-ec2/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:lygstate.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Building a SOCKS Proxy on EC2</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-12T21:15:00+08:00" pubdate data-updated="true">Jan 12<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><a href="http://eric.gerlach.ca/blog/2012/6/19/building-a-socks-proxy-on-ec2-to-get-around-wifi-port-blocki.html">Permalink</a></p>

<p>At the NXNE Mobile Hackathon, we ran into a small problem. The wifi set up in the room would only allow connections over HTTP and HTTPS, which made it impossible to do many things you might want to do at a hackathon, like:</p>

<ol>
<li>Push to GitHub over SSH</li>
<li>Connect to MongoDB instances</li>
<li>Connect to&#8230; anything&#8230; that isn&#8217;t on ports 80 or 443&#8230; so a lot.</li>
</ol>


<p>If you can configure your tools correctly, the easiest way to get around this kind of problem is via a SOCKS proxy. Normally, I&#8217;d set up an SSH tunnel and run the SOCKS proxy over that&#8230; but no SSH. So the next best thing is to get a SOCKS server running on EC2. Let&#8217;s go through the steps required to set this up so that if you end up in the same situation, you can help those around you.</p>

<p>Doing this assumes that you temporarily have an internet connection that is unrestricted, like a tethered smartphone or a wired connection. I&#8217;m also assuming that you know your way around EC2 a bit.</p>

<ol>
<li>Connect to your unrestricted internet connection</li>
<li>Login to EC2</li>
<li>Ensure that you have a keypair setup</li>
<li>Create an EC2 Security Group that opens ports 22 and 443 to the world</li>
<li>Fire up an Ubuntu 12.04 LTS instance (micro will usually do) with your keypair and Security Group</li>
<li>SSH into the new machine with the SSH key (default username: ubuntu)</li>
<li><p>Run the following commands at the prompt or in a shell script:</p>

<pre><code>sudo apt-get install build-essential
wget http://www.inet.no/dante/files/dante-1.3.2.tar.gz # or another version
tar -zxvf dante-1.3.2.tar.gz
cd dante-1.3.2
./configure
make
sudo make install
$ sudo make me a sandwich
</code></pre></li>
<li><p>Put the following config in /etc/sock.conf</p>

<pre><code>## general configuration (taken from FAQ)

internal: eth0 port = 443
external: eth0
method: username none
user.privileged: root
user.unprivileged: nobody
logoutput: stderr

## client access rules

client pass { from: 0.0.0.0/0 to: 0.0.0.0/0 } # address-range on internal nic.


## server operation access rules

# block connections to localhost, or they will appear to come from the proxy.
block { from: 0.0.0.0/0 to: lo log: connect }

# allow the rest
pass { from: 0.0.0.0/0 to: 0.0.0.0/0 }
</code></pre></li>
<li><p>Run <code>sudo sockd -D</code></p></li>
</ol>


<p>Now that we&#8217;ve got the server running, we have to configure our clients to connect to it. Fortunately, this is relatively easy. If you&#8217;re on linux, run your programs with tsocks. On Windows or Mac, you can try Proxifier (never tried it myself). Remember that the proxy is on port 443.</p>

<p>If you&#8217;re using PuTTY, you can set your proxy under Connection &gt; Proxy.</p>

<p>This set of steps creates an open proxy that anyone can use to proxy to anywhere. Don&#8217;t leave it running unless you want really big EC2 bills.</p>

<p>In doing this, I realized that it would be even better to be able to do this via a VPN instead of a SOCKS proxy in order to get better Windows and Mac full capture support. I&#8217;m going to play with this idea and post again when I&#8217;ve got something.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Yonggang Luo</span></span>

      








  


<time datetime="2013-01-12T21:15:00+08:00" pubdate data-updated="true">Jan 12<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/ec2/'>ec2</a>, <a class='category' href='/blog/categories/proxy/'>proxy</a>, <a class='category' href='/blog/categories/socks/'>socks</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://lygstate.github.com/blog/2013/01/12/building-a-socks-proxy-on-ec2/" data-via="" data-counturl="http://lygstate.github.com/blog/2013/01/12/building-a-socks-proxy-on-ec2/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/01/12/converting-between-different-ssh-private-slash-public-key-formats/" title="Previous Post: Converting between different SSH private/public key formats.">&laquo; Converting between different SSH private/public key formats.</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/01/12/building-a-socks-proxy-on-ec2/">Building a SOCKS proxy on EC2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/12/converting-between-different-ssh-private-slash-public-key-formats/">Converting between different SSH private/public key formats.</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Yonggang Luo -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
